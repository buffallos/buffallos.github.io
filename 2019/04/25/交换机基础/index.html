<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="交换机数据帧转发模式 Fast-forward 快速转发模式特点：检测到目的mac地址后立即转发优点：转发速度快缺点：不能自动学习CAM表项；不能对数据帧进行检验和纠错 store-and-forward特点：接收并缓存完整数据帧至本地，通过crc校验通过后再转发，数据帧有错则丢弃优点：能自动学习CAM表项；能执行数据帧检验和纠错缺点：增加交换机开销，转发效率低 fragment-free特点：只">
<meta property="og:type" content="article">
<meta property="og:title" content="交换机基础">
<meta property="og:url" content="http://yoursite.com/2019/04/25/交换机基础/index.html">
<meta property="og:site_name" content="Live in the moment">
<meta property="og:description" content="交换机数据帧转发模式 Fast-forward 快速转发模式特点：检测到目的mac地址后立即转发优点：转发速度快缺点：不能自动学习CAM表项；不能对数据帧进行检验和纠错 store-and-forward特点：接收并缓存完整数据帧至本地，通过crc校验通过后再转发，数据帧有错则丢弃优点：能自动学习CAM表项；能执行数据帧检验和纠错缺点：增加交换机开销，转发效率低 fragment-free特点：只">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-23T14:17:01.892Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="交换机基础">
<meta name="twitter:description" content="交换机数据帧转发模式 Fast-forward 快速转发模式特点：检测到目的mac地址后立即转发优点：转发速度快缺点：不能自动学习CAM表项；不能对数据帧进行检验和纠错 store-and-forward特点：接收并缓存完整数据帧至本地，通过crc校验通过后再转发，数据帧有错则丢弃优点：能自动学习CAM表项；能执行数据帧检验和纠错缺点：增加交换机开销，转发效率低 fragment-free特点：只">





  
  
  <link rel="canonical" href="http://yoursite.com/2019/04/25/交换机基础/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>交换机基础 | Live in the moment</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Live in the moment</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/25/交换机基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Buffallos">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Live in the moment">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">交换机基础

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-25 16:31:55" itemprop="dateCreated datePublished" datetime="2019-04-25T16:31:55+08:00">2019-04-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-23 22:17:01" itemprop="dateModified" datetime="2019-07-23T22:17:01+08:00">2019-07-23</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="交换机数据帧转发模式"><a href="#交换机数据帧转发模式" class="headerlink" title="交换机数据帧转发模式"></a>交换机数据帧转发模式</h3><ul>
<li>Fast-forward 快速转发模式<br>特点：检测到目的mac地址后立即转发<br>优点：转发速度快<br>缺点：不能自动学习CAM表项；不能对数据帧进行检验和纠错</li>
<li>store-and-forward<br>特点：接收并缓存完整数据帧至本地，通过crc校验通过后再转发，数据帧有错则丢弃<br>优点：能自动学习CAM表项；能执行数据帧检验和纠错<br>缺点：增加交换机开销，转发效率低</li>
<li>fragment-free<br>特点：只检测数据帧前64字节，用以判断是否为冲突碎片帧，如是则丢弃，不是则立即转发<br>优点：能自动学习CAM表项；转发效率中等，能够执行检查和纠错<h3 id="CAM表相关操作命令"><a href="#CAM表相关操作命令" class="headerlink" title="CAM表相关操作命令"></a>CAM表相关操作命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sw1# show mac address-table #查看CAM静态和动态表项</span><br><span class="line">sw1# show mac address-tables dynamic #查看动态学习表项</span><br><span class="line">sw1#show mac address-table dynamic vlan 11 #指定vlan</span><br><span class="line">sw1#show mac address-table aging-time # 查询超时时长</span><br><span class="line">sw1#show mac address-table aging-time vlan 11 # 指定vlan</span><br><span class="line">sw1(config)#mac address-table aging-time #修改超时时长</span><br><span class="line">sw1(config)#mac address-table static aaaa.bbbb.cccc vlan 11 interface ethernet 0/0 #添加静态CAM表项并指vlan和交换机端口</span><br><span class="line">sw1(config)#mac address-table static aaaa.bbbb.cccc vlan 11 interface drop # drop端口丢失所以绑定该端口的CAM表项mac相关数据帧</span><br><span class="line">sw1#clear mac address-table dynamic vlan 11 #清除指定vlan的动态学习到的CAM表项</span><br><span class="line"></span><br><span class="line">sw1#clear mac address-table dynamic vlan 11 # 清除交换机配置</span><br><span class="line">sw1#delete flash:vlan.dat #清除vlan信息库</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h3><ul>
<li>优点<br>隔离广播域<br>增强网络安全性<br>便于管理,增强数据保密性</li>
<li>默认vlan<br>cisco交换机默认vlan名 vlan1<br>交换机未做配置情况下,所有端口属于vlan1</li>
<li>部署vlan<br>vlan划分依据为企业部门,建议本地vlan部署,在一个交换区块,不要使用end-to-end方式部署,同一个vlan的客户端ip地址在同一个子网段<blockquote>
</blockquote>
动态vlan<br>静态vlan</li>
<li>SVI<br>交换机vlan接口,每个vlan都可以创建svi,但是同事只有一个svi能配置ip然后工作,实现ip通讯</li>
</ul>
<h4 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h4><ul>
<li>查看vlan<br>sw1#show vlan brief</li>
<li>创建vlan<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sw1(config-vlan)#vlan 100 # 创建vlan 100</span><br><span class="line">sw1(config-vlan)#name HR # 定义vlan别名</span><br><span class="line">关联端口到vlan</span><br><span class="line">sw1(config)#interface ethernet 0/0</span><br><span class="line">sw1(config-if)#switchport access vlan 100</span><br><span class="line">sw1(config-if)#switchport mode access</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="vlan分类"><a href="#vlan分类" class="headerlink" title="vlan分类"></a>vlan分类</h4><ul>
<li>数据vlan</li>
<li>语音vlan<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sw1(config)#vlan 200</span><br><span class="line">sw1(config-vlan)#name VoIP</span><br><span class="line">sw1(config)#interface ethernet 0/0</span><br><span class="line">sw1(config-if)#switchport voice vlan 200</span><br><span class="line">sw1#show run interface ethernet 0/0</span><br><span class="line">Building configuration...</span><br><span class="line"></span><br><span class="line">Current configuration : 108 bytes</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport access vlan 100</span><br><span class="line"> switchport mode access</span><br><span class="line"> switchport voice vlan 200</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>同时划分一个交换机多个接口至同一vlan</strong><br>案例一<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sw1(config)#interface range ethernet 0/1 -5</span><br><span class="line">sw1(config-if-range)#switchport mode access</span><br><span class="line">sw1(config-if-range)#switchport access vlan 100</span><br></pre></td></tr></table></figure></p>
<p>案例二<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sw1(config)#interface range ethernet 0/1, ethernet 0/3, ethernet 0/4 -7</span><br><span class="line">sw1(config-if-range)#switchport mode access</span><br><span class="line">sw1(config-if-range)#switchport access vlan 100</span><br></pre></td></tr></table></figure></p>
<h4 id="vlan类别"><a href="#vlan类别" class="headerlink" title="vlan类别"></a>vlan类别</h4><p><code>vlan编号有12byte, 范围0 -4095</code></p>
<ol>
<li>0, 4095 保留</li>
<li>1 cisco默认vlan,交换机默认端口划为此vlan</li>
<li>1002-1005,保留,用于FDDI 和 Token Ring,一般生产环境用不到</li>
<li>2-1001,标准vlan,低端交换机</li>
<li>1006-4094 扩展vlan,有使用条件<br><em>必须是三层交换机,最低思科3550</em><br><em>交换机的VTP必须是透明模式,transparent</em></li>
</ol>
<h4 id="关闭域名动态解析"><a href="#关闭域名动态解析" class="headerlink" title="关闭域名动态解析"></a>关闭域名动态解析</h4><p><code>sw1(config)#no ip domain-lookup</code></p>
<h4 id="Trunk"><a href="#Trunk" class="headerlink" title="Trunk"></a>Trunk</h4><p><strong>TRUNK</strong><br>vlan中继链路，用于承载所有vlan的数据帧传输</p>
<ul>
<li>DTP协议，Dynamic Trunk Protocol 动态协商中继协议<br>根据中继端口的管理模式最终协商链路模式</li>
<li>查看中继线路摘要信息<br><code>sw2#show interfaces trunk</code></li>
<li><p>配置端口为802.1q TRUNK 模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sw2(config)#interface ethernet 0/0</span><br><span class="line">sw2(config-if)#switchport trunk encapsulation dot1q</span><br><span class="line">sw2(config-if)#switchport mode trunk</span><br></pre></td></tr></table></figure>
</li>
<li><p>恢复端口缺省配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sw2(config)#default interface ethernet 0/0</span><br><span class="line">Interface Ethernet0/0 set to default configuration</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改native vlan<br><code>sw2(config-if)#switchport trunk native vlan 100</code></p>
</li>
<li>链路两端手动配置trunk后关闭DTP包传送<br><code>sw2(config-if)#switchport nonegotiate</code></li>
<li>显示交换机端口详细信息<br><code>sw2#show interfaces ethernet 0/0 switchport</code></li>
<li><p>配置交换机端口管理模式为动态协商模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sw1(config-if)#switchport mode dynamic</span><br><span class="line">  auto       Set trunking mode dynamic negotiation parameter to AUTO</span><br><span class="line">  desirable  Set trunking mode dynamic negotiation parameter to DESIRABLE</span><br></pre></td></tr></table></figure>
</li>
<li><p>为native vlan打标签<br><code>sw2(config)#vlan dot1q tag native</code></p>
</li>
<li>配置中继链路允许通过的vlan，默认允许所有vlan通过<br><code>sw2(config-if)#switchport trunk allowed vlan 1-200</code></li>
<li>配置中继链路添加允许vlan<br><code>sw2(config-if)#switchport trunk allowed vlan add 101</code></li>
<li>配置中继链路排除允许某个vlan<br><code>sw2(config-if)#switchport trunk allowed vlan except 50</code></li>
<li><p>配置中继链路，删除一个允许通过的vlan<br><code>sw2(config-if)#switchport trunk allowed vlan remove 60</code></p>
<h4 id="Tunneling"><a href="#Tunneling" class="headerlink" title="Tunneling"></a>Tunneling</h4><blockquote>
<p>802/1Q Tunneling是交换机二层隧道协议，利用双层打标vlan的方式实现二层隧道转发。该项配置需要客户端端口必需dot1q trunk模式，运营商端接口dot1q-tunnel模式，并且需要更改全局mtu</p>
</blockquote>
</li>
<li><p>802.1Q Tunneling 端口配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sw1(config-if)switchport mode dot1q-tunnel</span><br><span class="line">sw1(config-if)switchport access vlan 666</span><br><span class="line">sw1(config-if)no shutdown</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改MTU ，必需全局模式<br><code>sw1(config)system mtu 1504</code></p>
</li>
<li>l2protocol-tunnel 由于端口配置802.1Q Tunneling后，cdp协议自动被关闭，需手动开启;在802.1Q Tunneling的端口下<br><code>sw1(config-if)l2protocol-tunnel cdp {cdp|stp|vtp|...}</code><br><strong>VTP</strong><br><em>VTP</em> Vlan Trunking Protocol 在一个vtp域中使用vtp协议同步vlan信息</li>
<li>vtp域 多台交换机使用trunk链路连接在一起，组成vtp域</li>
<li>vtp 角色 缺省角色 server<br>server：<br>创建、修改、删除vlan<br>会发送vtp通告<br>可以接收其它server vtp通告，同步vlan信息<br>保存vlan信息至nvram<br>收到vtp通告会泛洪<br>client：<br>不能主动创建、修改和删除vlan信息，只能通过server通告报文学习<br>只收不发vtp通告<br>不保存至本地nvram<br>收到vtp通过会泛洪<br>transparent<br>创建、修改、删除本地vlan<br>不会发送vtp通告，也不会学习server发出的通告信息<br>v1不会泛洪，v2会泛洪</li>
<li>查看vtp状态<br><code>sw1#show vtp status</code></li>
<li><p>配置vtp domain</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sw1(config)#vtp domain ccie</span><br><span class="line">Changing VTP domain name from NULL to ccie</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置vtp角色 前提是在某一台是配置vtp domain</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sw1(config)#vtp mode server</span><br><span class="line">Device mode already VTP Server for VLANS.</span><br><span class="line">sw2(config)#vtp mode transparent</span><br><span class="line">Setting device to VTP Transparent mode for VLANS.</span><br><span class="line">sw3(config)#vtp mode client</span><br><span class="line">Setting device to VTP Client mode for VLANS.</span><br></pre></td></tr></table></figure>
</li>
<li><p>vlan数据库修改次数计数<br><code>Configuration Revision            : 6</code></p>
</li>
<li>修改交换机运行vtp 版本  开启版本2 只需server端以及Transparent端开启即可<br><code>sw1(config)#vtp version 2</code></li>
<li>vtp通告类型<br>vtp组播地址：01－00－0C－CC－CC－CC<br>VTP通告有三种类型：</li>
</ul>
<p>汇总通告(Summary Advertisements)：汇总通告包含VTP域名、配置修正号以及配置的一些细节。汇总通告有两种发送方式:周期性发送，每隔5分钟被VTP Server或VTP Client发送。触发发送，如果VTP配置发生变化VTP通告立即发送。<br>子集通告(Subset Advertisements)：在创建或删除VLAN、挂起或激活VLAN、更改VLAN名称、改变VLAN UTM时会发送子集通告。<br>查询通告(Request Advertisements)：当VTP Server收到一个查询通告时，VTP Server会发送一个VTP汇总通告和一个VTP子集通告。下面这些情况会发送查询通告：VTP域名发生变化时、交换机收到一个汇总通告，通告中的配置修正号高于本交换机的配置修正号、因为某些原因子集通告丢失、交换机重启。</p>
<ul>
<li>新加入交换机vtp配置修订号清零方式<br>更改vtp模式为transparent，然后改回client<br>更改client模式，vtp domain更改，然后同步</li>
<li>vtp 裁剪 如果交换机收到基于vlan需泛洪流量，如果邻居下游不存在该vlan成员，则不再向此交换机泛洪<br>开启vtp裁剪，只能在vtp server和transparent上可以开启<br>sw1(config)#vtp pruning<br>Pruning switched on<h4 id="部署顺序"><a href="#部署顺序" class="headerlink" title="部署顺序"></a>部署顺序</h4></li>
</ul>
<ol>
<li>交换机间起trunk 如果中继链路起不来，可以接口shutdown,然后 no  shutdown</li>
<li>部署vtp<br>show vtp status</li>
<li>创建vlan<br>show vlan brief</li>
<li>定义Access Port<br>show interface INTERFACE switchport<h3 id="STP生成树协议-802-1D"><a href="#STP生成树协议-802-1D" class="headerlink" title="STP生成树协议 802.1D"></a>STP生成树协议 802.1D</h3>在二层的冗余环境中，stp机制能够逻辑的阻塞相关冗余路径，从而形成树型拓扑，规避环路造成的广播风暴<h4 id="使用BPDU报文"><a href="#使用BPDU报文" class="headerlink" title="使用BPDU报文"></a>使用BPDU报文</h4></li>
</ol>
<ul>
<li>类似于vtp的通告报文，使用组播形式在中继链路发送 组播地址：01-80-c2-00-00-00</li>
<li>周期性发送，hello事件为2s<h4 id="根桥选举"><a href="#根桥选举" class="headerlink" title="根桥选举"></a>根桥选举</h4></li>
<li>选举依据 Bridge ID的优先级（2字节，0-65535，缺省 32768，越小越好，修改需要为4096倍数）和背板mac地址（6字节，谁小谁优先）</li>
<li>根桥的ID就是根桥的Bridage ID，称之为Root ID。<h4 id="非根桥选举RP"><a href="#非根桥选举RP" class="headerlink" title="非根桥选举RP"></a>非根桥选举RP</h4></li>
<li>非根桥交换机去往根桥最近的端口，称之为根端口，有且只有一个<br>#####　选举依据</li>
<li>Cost of path 非根端口去往根桥的开销；非根桥所有收到根桥bpdu控制层面流入方向的开销累加<br>10 Gbps  2<br>1 Gbps 4<br>100 Mbps 19<br>10 Mbps 100</li>
<li>收到bpdu报文中发送者的Bridge ID</li>
<li>收到bpdu报文中发送者的Port ID，2个字节（1字节， 0-255，缺省值128，如需更改，必须是16的倍数；1字节，接口的端口号）<h4 id="未被选为RP的链路两端的非同一台交换机的两个端口中选举DP和NDP"><a href="#未被选为RP的链路两端的非同一台交换机的两个端口中选举DP和NDP" class="headerlink" title="未被选为RP的链路两端的非同一台交换机的两个端口中选举DP和NDP"></a>未被选为RP的链路两端的非同一台交换机的两个端口中选举DP和NDP</h4><h5 id="指定端口-DP-RP的对端一定是DP，DP对端有可能是RP，也有可能是NDP"><a href="#指定端口-DP-RP的对端一定是DP，DP对端有可能是RP，也有可能是NDP" class="headerlink" title="指定端口 DP RP的对端一定是DP，DP对端有可能是RP，也有可能是NDP"></a>指定端口 DP RP的对端一定是DP，DP对端有可能是RP，也有可能是NDP</h5></li>
<li>比较发送方向的cop</li>
<li>比较发送者的bridge id</li>
<li>比较port id<h5 id="非指定端口-NDP"><a href="#非指定端口-NDP" class="headerlink" title="非指定端口 NDP"></a>非指定端口 NDP</h5><h4 id="收敛加速机制"><a href="#收敛加速机制" class="headerlink" title="收敛加速机制"></a>收敛加速机制</h4><h5 id="Portfast-是接入接口跳过stp计算，使access端口从block状态直接调到forward状态，建议在所有交换机连接PC-服务器-路由器的接口上，不要在交换机连接的接口上启用"><a href="#Portfast-是接入接口跳过stp计算，使access端口从block状态直接调到forward状态，建议在所有交换机连接PC-服务器-路由器的接口上，不要在交换机连接的接口上启用" class="headerlink" title="Portfast 是接入接口跳过stp计算，使access端口从block状态直接调到forward状态，建议在所有交换机连接PC 服务器 路由器的接口上，不要在交换机连接的接口上启用"></a>Portfast 是接入接口跳过stp计算，使access端口从block状态直接调到forward状态，建议在所有交换机连接PC 服务器 路由器的接口上，不要在交换机连接的接口上启用</h5>show spanning tree vlan 10<h5 id="UplinkFast-在页节点交换机上面部署，接入层交换机"><a href="#UplinkFast-在页节点交换机上面部署，接入层交换机" class="headerlink" title="UplinkFast 在页节点交换机上面部署，接入层交换机;"></a>UplinkFast 在页节点交换机上面部署，接入层交换机;</h5>show spanning tree uplinkfast<br>spanning tree uplinkfast max-update-rate 200<h5 id="BackboeFast-收到次级BPDU会发RLQ-REQUEST给根桥查询根桥是否正常-所有stp域内交换机成员"><a href="#BackboeFast-收到次级BPDU会发RLQ-REQUEST给根桥查询根桥是否正常-所有stp域内交换机成员" class="headerlink" title="BackboeFast 收到次级BPDU会发RLQ REQUEST给根桥查询根桥是否正常 所有stp域内交换机成员"></a>BackboeFast 收到次级BPDU会发RLQ REQUEST给根桥查询根桥是否正常 所有stp域内交换机成员</h5>当一台交换机通过NDP接口收到次级BPDU则该交换机汇通过RP发送RLQ的REQUEST报文，如果该交换机通过RP收到了次级BPDU则该交换机会判断自己是否拥有NDP接口，如果有则通过所有NDP接口会发送RLQ的REQUES；如果没有，则该交换机认为自己失去了与根桥的连通性，该交换机会选自己为新的根桥，加速收敛节约了20s时间</li>
</ul>
<h3 id="RSTP-快速生成树协议-802-1w"><a href="#RSTP-快速生成树协议-802-1w" class="headerlink" title="RSTP 快速生成树协议 802.1w"></a>RSTP 快速生成树协议 802.1w</h3><h4 id="PORT-Status"><a href="#PORT-Status" class="headerlink" title="PORT Status"></a>PORT Status</h4><ul>
<li>Discarding</li>
<li>Learning</li>
<li>Forwarding<h4 id="PORT-Role"><a href="#PORT-Role" class="headerlink" title="PORT Role"></a>PORT Role</h4></li>
<li>Root Ports</li>
<li>Designated Ports</li>
<li>Alternative Port</li>
<li>Backup Port<h4 id="Port-Category"><a href="#Port-Category" class="headerlink" title="Port Category"></a>Port Category</h4></li>
<li>Edge Port</li>
<li>Nonedge Port<h4 id="RSTP-Links-Types-取决于双工模式"><a href="#RSTP-Links-Types-取决于双工模式" class="headerlink" title="RSTP Links Types 取决于双工模式"></a>RSTP Links Types 取决于双工模式</h4></li>
<li>p2p links  全双工</li>
<li>Shared links 半双工</li>
<li>双工模式修改，端口配置模式下 duplex half</li>
<li>半双工模式下修改链路为p2p<br><code>sw3(config-if)#spanning-tree link-type point-to-point</code></li>
<li>RSTP BPDU Proposal and Agreement<h4 id="RSTP分段收敛"><a href="#RSTP分段收敛" class="headerlink" title="RSTP分段收敛"></a>RSTP分段收敛</h4></li>
<li>只能在p2p链路使用</li>
<li>共享型链路只能使用802.1d<h4 id="RSTP-Topology-Change-Mechanism-快速收敛协议的拓扑变更处理机制"><a href="#RSTP-Topology-Change-Mechanism-快速收敛协议的拓扑变更处理机制" class="headerlink" title="RSTP Topology Change Mechanism 快速收敛协议的拓扑变更处理机制"></a>RSTP Topology Change Mechanism 快速收敛协议的拓扑变更处理机制</h4><h4 id="RSTP启用"><a href="#RSTP启用" class="headerlink" title="RSTP启用"></a>RSTP启用</h4><code>sw1(config)#spanning-tree mode rapid-pvst</code></li>
<li>修改桥ID优先级<br><code>sw3(config)#spanning-tree vlan 10 priority 4096</code></li>
<li>修改接口cost<br><code>sw3(config-if)#spanning-tree vlan 74 cost 10</code></li>
<li>修改端口优先级<br><code>sw3(config-if)#spanning-tree vlan 74 port-priority 112</code><h3 id="MSTP-MST-MIST-802-1S"><a href="#MSTP-MST-MIST-802-1S" class="headerlink" title="MSTP/MST/MIST 802.1S"></a>MSTP/MST/MIST 802.1S</h3></li>
<li>可定义 0-15进程</li>
<li>0： ISTI</li>
<li>1-15 ： MSTI</li>
<li>默认启用0号进程 缺省进程</li>
</ul>
<ol>
<li>相同domain name</li>
<li>相同revision</li>
<li>相同的进程到vlan的映射<h4 id="启用mstp"><a href="#启用mstp" class="headerlink" title="启用mstp"></a>启用mstp</h4></li>
</ol>
<ul>
<li>启用mstp<br><code>sw3(config)#spanning-tree mode mst</code></li>
<li>查看mstp配置信息<br><code>sw3#show spanning-tree mst configuration</code></li>
<li>修改mstp配置信息，进入配置模式<br><code>sw1(config)#spanning-tree mst configuration</code></li>
<li>定义域名<br><code>sw1(config-mst)#name Cisco</code></li>
<li>定义revision<br><code>sw1(config-mst)#revision 1</code></li>
<li><p>配置模式下查看配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sw2(config-mst)#show pending</span><br><span class="line">Pending MST configuration</span><br><span class="line">Name      [Cisco]</span><br><span class="line">Revision  1     Instances configured 1</span><br><span class="line"></span><br><span class="line">Instance  Vlans mapped</span><br><span class="line">--------  ---------------------------------------------------------------------</span><br><span class="line">0         1-4094</span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>映射vlan</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sw1(config-mst)#instance 1 vlan</span><br><span class="line">sw1(config-mst)#instance 1 vlan 10,20,30,40,50</span><br><span class="line">sw1(config-mst)#instance 2 vlan 60,70,80,90,100</span><br><span class="line">sw1(config-mst)#show pending</span><br><span class="line">Pending MST configuration</span><br><span class="line">Name      [Cisco]</span><br><span class="line">Revision  1     Instances configured 3</span><br><span class="line">Instance  Vlans mapped</span><br><span class="line">--------  ---------------------------------------------------------------------</span><br><span class="line">0         1-9,11-19,21-29,31-39,41-49,51-59,61-69,71-79,81-89,91-99,101-4094</span><br><span class="line">1         10,20,30,40,50</span><br><span class="line">2         60,70,80,90,100</span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定交换机为某mstp进程的根桥<br><code>sw1(config)#spanning-tree mst 2 root primary</code></p>
</li>
<li><p>查看信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sw2#show spanning-tree mst</span><br><span class="line">sw2# show spanning-tree root detail</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改拓扑直接 以改变生成树的计时器<br><code>sw3(config)#spanning-tree vlan 1-4094 root secondary diameter 3</code></p>
</li>
</ul>
<p>###　以太信道　　以太网聚合</p>
<p>####　功能　　增加交换机间链接带宽</p>
<h4 id="实现协议"><a href="#实现协议" class="headerlink" title="实现协议"></a>实现协议</h4><p>－PAgP 思科私有链路聚合协议</p>
<ul>
<li>LACP 公有链路聚合协议 IEEE 802.3ad standard<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4></li>
<li>捆绑链路必须有相同的物理属性，带宽、延迟，双工模式必须一致</li>
<li>捆绑链路必须有相同的逻辑属性，二层或三层</li>
<li>捆绑的数量必须是 2、4、8不能是其它值，捆绑后会生成port-channel<h5 id="PAgP"><a href="#PAgP" class="headerlink" title="PAgP"></a>PAgP</h5></li>
<li><p>进入需要捆绑的端口模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sw1(config-if-range)#channel-protocol pagp</span><br><span class="line">sw1(config-if-range)#channel-group 12 mode auto</span><br><span class="line">Creating a port-channel interface Port-channel 12</span><br><span class="line">sw1(config-if-range)#no shutdown</span><br><span class="line"></span><br><span class="line">sw1#show ip interface brief</span><br><span class="line">Interface              IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/0            unassigned      YES unset  up                    up</span><br><span class="line">Ethernet0/1            unassigned      YES unset  up                    up</span><br><span class="line">Ethernet0/2            unassigned      YES unset  up                    up</span><br><span class="line">Ethernet0/3            unassigned      YES unset  up                    up</span><br><span class="line">Port-channel12         unassigned      YES unset  down                  down</span><br></pre></td></tr></table></figure>
</li>
<li><p>pagp如果开启自动协商，则默认协商的子模式为Silent，在该模式中即便链路没收到对端发送的PAgP协商帧，链路也会协商成以太信道，一般关闭静默子模式，此模式必须在auto mode中才有才可关闭，关闭后对端需要是desirable模式</p>
</li>
</ul>
<p><code>sw2(config-if-range)#channel-group 12 mode auto non-silent</code></p>
<ul>
<li>查看信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sw1#show etherchannel summary</span><br><span class="line">Flags:  D - down        P - bundled in port-channel</span><br><span class="line">        I - stand-alone s - suspended</span><br><span class="line">        H - Hot-standby (LACP only)</span><br><span class="line">        R - Layer3      S - Layer2</span><br><span class="line">        U - in use      N - not in use, no aggregation</span><br><span class="line">        f - failed to allocate aggregator</span><br><span class="line"></span><br><span class="line">        M - not in use, minimum links not met</span><br><span class="line">        m - not in use, port not aggregated due to minimum links not met</span><br><span class="line">        u - unsuitable for bundling</span><br><span class="line">        w - waiting to be aggregated</span><br><span class="line">        d - default port</span><br><span class="line"></span><br><span class="line">        A - formed by Auto LAG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Number of channel-groups in use: 1</span><br><span class="line">Number of aggregators:           1</span><br><span class="line"></span><br><span class="line">Group  Port-channel  Protocol    Ports</span><br><span class="line">------+-------------+-----------+-----------------------------------------------</span><br><span class="line">12     Po12(SU)        PAgP      Et0/0(P)    Et0/1(P)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="lacp"><a href="#lacp" class="headerlink" title="lacp"></a>lacp</h5><ul>
<li>lacp协议以太网信道绑定模式与page配置一样但是可选择mode只有passive和active<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sw3(config-if-range)#channel-group 21 mode active</span><br><span class="line">Creating a port-channel interface Port-channel 21</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="启用以太信道的的要求"><a href="#启用以太信道的的要求" class="headerlink" title="启用以太信道的的要求"></a>启用以太信道的的要求</h4><ul>
<li>端口需要支持以太信道绑定</li>
<li>端口成员必须有相同的物理属性</li>
<li>端口成员不能成为span（交换机端口分析的源和目的接口）</li>
<li>ip地址只能在三层绑定信道的port-channel接口上配置</li>
<li>所有成员必须是access接口或者trunk接口；access接口必须属于同一个vlan；trunk接口必须是同一种trunk封装协议</li>
<li>如果端口成员为trunk接口，trunk所允许通过的vlan必须一致</li>
<li>成员所在的生成树的cost可以不同</li>
<li>在生成的信道接口上所做的配置改变，会影响到所有组成该信道的端口成员</li>
<li>在生成以太信道后，成员端口所作修改只能影响成员本身</li>
<li>在生成一台信道后，生成树协议将不再关心一台信道成员物理接口，仅仅会关系所生成的 port-channel接口<h4 id="以太信道的负载均衡"><a href="#以太信道的负载均衡" class="headerlink" title="以太信道的负载均衡"></a>以太信道的负载均衡</h4></li>
<li>src-mac 根据源mac地址的负载均衡</li>
<li>dst-mac 根据目的mac地址的负载均衡</li>
<li>src-ip 根据源ip地址的负载均衡</li>
<li>dst-ip 根据目的ip地址的负载郡航</li>
<li>src-dst-mac 根据源和目的mac地址的负载均衡</li>
<li>src-dst-ip 根据源和目的的ip地址的负载均衡</li>
<li>以太信道的负载均衡在本地交换机配置生效</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sw1(config)#port-channel load-balance ?</span><br><span class="line">dst-ip       Dst IP Addr</span><br><span class="line">dst-mac      Dst Mac Addr</span><br><span class="line">src-dst-ip   Src XOR Dst IP Addr</span><br><span class="line">src-dst-mac  Src XOR Dst Mac Addr</span><br><span class="line">src-ip       Src IP Addr</span><br><span class="line">src-mac      Src Mac Addr</span><br></pre></td></tr></table></figure>
<h4 id="Root-Guard"><a href="#Root-Guard" class="headerlink" title="Root Guard"></a>Root Guard</h4><p> 为了保护spanning tree的稳定性，Root Guard交换机接非交换的端口上，当配置了Root Guard的端口接收到更优的bpdu时，该端口就会被阻塞进入broken状态，当不再收到更优的BPDU时会自动恢复。</p>
<ul>
<li>配置命令，端口下配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s4(config-9f)#spanning-tree guard root</span><br><span class="line">sw4#show spanning-tree inconsistentports</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="loop-Guard"><a href="#loop-Guard" class="headerlink" title="loop Guard"></a>loop Guard</h4><p>生成树的防环防护 配置于非根桥的NDP接口</p>
<ul>
<li>配置命令<br><code>sw2(config-if)#spanning-tree guard loop</code><h4 id="UDLD-单向链路检测-在链路两端配置为相同模式-建议使用于光纤交换机互联的光纤接口上"><a href="#UDLD-单向链路检测-在链路两端配置为相同模式-建议使用于光纤交换机互联的光纤接口上" class="headerlink" title="UDLD 单向链路检测 在链路两端配置为相同模式,建议使用于光纤交换机互联的光纤接口上"></a>UDLD 单向链路检测 在链路两端配置为相同模式,建议使用于光纤交换机互联的光纤接口上</h4><code>sw2(config-if)#udld port</code><h4 id="BPDU-GUARD-BPDU防护-配置于开启了portfast特性的端口"><a href="#BPDU-GUARD-BPDU防护-配置于开启了portfast特性的端口" class="headerlink" title="BPDU GUARD BPDU防护 配置于开启了portfast特性的端口"></a>BPDU GUARD BPDU防护 配置于开启了portfast特性的端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sw4(config-if)#spanning-tree bpduguard enable</span><br><span class="line">sw4(config)#spanning-tree portfast bpduguard default</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="BPDU-filter-配置于开启了portfast特性的端口"><a href="#BPDU-filter-配置于开启了portfast特性的端口" class="headerlink" title="BPDU filter 配置于开启了portfast特性的端口"></a>BPDU filter 配置于开启了portfast特性的端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sw4(config)#spanning-tree portfast bpdufilter default</span><br><span class="line">sw4(config-if)#spanning-tree bpdufilter enable</span><br></pre></td></tr></table></figure>
<ul>
<li>优先级：接口级别的bpdufilter；接口级别的BUDU Guard；全局级别的BPDU GUARD；全局级的BPDUFILTER</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/30/三层交换/" rel="prev" title="三层交换">
                三层交换 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Buffallos</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/buffallos" title="GitHub &rarr; https://github.com/buffallos" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:p270640624@gmail.com" title="E-Mail &rarr; mailto:p270640624@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#交换机数据帧转发模式"><span class="nav-number">1.</span> <span class="nav-text">交换机数据帧转发模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CAM表相关操作命令"><span class="nav-number">2.</span> <span class="nav-text">CAM表相关操作命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VLAN"><span class="nav-number">3.</span> <span class="nav-text">VLAN</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#常用操作"><span class="nav-number">3.1.</span> <span class="nav-text">常用操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vlan分类"><span class="nav-number">3.2.</span> <span class="nav-text">vlan分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vlan类别"><span class="nav-number">3.3.</span> <span class="nav-text">vlan类别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关闭域名动态解析"><span class="nav-number">3.4.</span> <span class="nav-text">关闭域名动态解析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Trunk"><span class="nav-number">3.5.</span> <span class="nav-text">Trunk</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Tunneling"><span class="nav-number">3.6.</span> <span class="nav-text">Tunneling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#部署顺序"><span class="nav-number">3.7.</span> <span class="nav-text">部署顺序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#STP生成树协议-802-1D"><span class="nav-number">4.</span> <span class="nav-text">STP生成树协议 802.1D</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用BPDU报文"><span class="nav-number">4.1.</span> <span class="nav-text">使用BPDU报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根桥选举"><span class="nav-number">4.2.</span> <span class="nav-text">根桥选举</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#非根桥选举RP"><span class="nav-number">4.3.</span> <span class="nav-text">非根桥选举RP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#未被选为RP的链路两端的非同一台交换机的两个端口中选举DP和NDP"><span class="nav-number">4.4.</span> <span class="nav-text">未被选为RP的链路两端的非同一台交换机的两个端口中选举DP和NDP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#指定端口-DP-RP的对端一定是DP，DP对端有可能是RP，也有可能是NDP"><span class="nav-number">4.4.1.</span> <span class="nav-text">指定端口 DP RP的对端一定是DP，DP对端有可能是RP，也有可能是NDP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#非指定端口-NDP"><span class="nav-number">4.4.2.</span> <span class="nav-text">非指定端口 NDP</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#收敛加速机制"><span class="nav-number">4.5.</span> <span class="nav-text">收敛加速机制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Portfast-是接入接口跳过stp计算，使access端口从block状态直接调到forward状态，建议在所有交换机连接PC-服务器-路由器的接口上，不要在交换机连接的接口上启用"><span class="nav-number">4.5.1.</span> <span class="nav-text">Portfast 是接入接口跳过stp计算，使access端口从block状态直接调到forward状态，建议在所有交换机连接PC 服务器 路由器的接口上，不要在交换机连接的接口上启用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#UplinkFast-在页节点交换机上面部署，接入层交换机"><span class="nav-number">4.5.2.</span> <span class="nav-text">UplinkFast 在页节点交换机上面部署，接入层交换机;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BackboeFast-收到次级BPDU会发RLQ-REQUEST给根桥查询根桥是否正常-所有stp域内交换机成员"><span class="nav-number">4.5.3.</span> <span class="nav-text">BackboeFast 收到次级BPDU会发RLQ REQUEST给根桥查询根桥是否正常 所有stp域内交换机成员</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RSTP-快速生成树协议-802-1w"><span class="nav-number">5.</span> <span class="nav-text">RSTP 快速生成树协议 802.1w</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PORT-Status"><span class="nav-number">5.1.</span> <span class="nav-text">PORT Status</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PORT-Role"><span class="nav-number">5.2.</span> <span class="nav-text">PORT Role</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Port-Category"><span class="nav-number">5.3.</span> <span class="nav-text">Port Category</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSTP-Links-Types-取决于双工模式"><span class="nav-number">5.4.</span> <span class="nav-text">RSTP Links Types 取决于双工模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSTP分段收敛"><span class="nav-number">5.5.</span> <span class="nav-text">RSTP分段收敛</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSTP-Topology-Change-Mechanism-快速收敛协议的拓扑变更处理机制"><span class="nav-number">5.6.</span> <span class="nav-text">RSTP Topology Change Mechanism 快速收敛协议的拓扑变更处理机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSTP启用"><span class="nav-number">5.7.</span> <span class="nav-text">RSTP启用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MSTP-MST-MIST-802-1S"><span class="nav-number">6.</span> <span class="nav-text">MSTP/MST/MIST 802.1S</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#启用mstp"><span class="nav-number">6.1.</span> <span class="nav-text">启用mstp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实现协议"><span class="nav-number">6.2.</span> <span class="nav-text">实现协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置"><span class="nav-number">6.3.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#PAgP"><span class="nav-number">6.3.1.</span> <span class="nav-text">PAgP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lacp"><span class="nav-number">6.3.2.</span> <span class="nav-text">lacp</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用以太信道的的要求"><span class="nav-number">6.4.</span> <span class="nav-text">启用以太信道的的要求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#以太信道的负载均衡"><span class="nav-number">6.5.</span> <span class="nav-text">以太信道的负载均衡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Root-Guard"><span class="nav-number">6.6.</span> <span class="nav-text">Root Guard</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#loop-Guard"><span class="nav-number">6.7.</span> <span class="nav-text">loop Guard</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDLD-单向链路检测-在链路两端配置为相同模式-建议使用于光纤交换机互联的光纤接口上"><span class="nav-number">6.8.</span> <span class="nav-text">UDLD 单向链路检测 在链路两端配置为相同模式,建议使用于光纤交换机互联的光纤接口上</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BPDU-GUARD-BPDU防护-配置于开启了portfast特性的端口"><span class="nav-number">6.9.</span> <span class="nav-text">BPDU GUARD BPDU防护 配置于开启了portfast特性的端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BPDU-filter-配置于开启了portfast特性的端口"><span class="nav-number">6.10.</span> <span class="nav-text">BPDU filter 配置于开启了portfast特性的端口</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Buffallos</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>




  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
